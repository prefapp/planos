nombre: php_mysql_app

autor: "Equipo PrefApp <info@prefapp.in>"

version: 0.1

descripcion: >

  "Aplicacion web con nginx, php-fpm y MySQL de backend"

coming_soon: 1

category: stacks

tags:
  - lamp
  - php
  - mysql
  - web

construcciones:

  app_data:
    image: busybox
    volumes:
      - /var/log
      - "@{app}#{data_dir}"

  app:
    role: app_php

    command: "/root/start.sh"

    ports:
      - "80:80"

    links:
      - "db:#{db_host}"

    volumes_from:
      - app_data

    parameters:
      # user defined
      data_dir:
        variable:
          display_name: "Directory where app stores data"
          validations:
            predefined: 'unix_path'
          field_type: text
        user_provided: 1

      repo_url:
        riyic:
          name: "app/php/fcgi_apps/[0]/repo_url"
          recipe: "app_php::fcgi_app"
        user_provided: 1

      repo_type:
        riyic:
          name: "app/php/fcgi_apps/[0]/repo_type"
          recipe: "app_php::fcgi_app"
        value: "git"
        user_provided: 1

      revision:
        riyic:
          name: "app/php/fcgi_apps/[0]/revision"
          recipe: "app_php::fcgi_app"
        value: "HEAD"
        user_provided: 1

      credential:
        riyic:
          name: "app/php/fcgi_apps/[0]/credential"
          recipe: "app_php::fcgi_app"
        value: xxx
        user_provided: 1

      extra_packages:
        riyic:
          name: "app/php/fcgi_apps/[0]/extra_packages"
          recipe: "app_php::fcgi_app"
        value: []
        user_provided: 1

      extra_modules:
        riyic:
          name: "app/php/fcgi_apps/[0]/extra_modules"
          recipe: "app_php::fcgi_app"
        value: []
        user_provided: 1

      timeout:
        riyic:
          name: "app/php/fcgi_apps/[0]/timeout"
          recipe: "app_php::fcgi_app"
        value: 300
        user_provided: 1

      php_ini_admin_values:
        riyic:
          name: "app/php/fcgi_apps/[0]/php_ini_admin_values"
          recipe: "app_php::fcgi_app"
        user_provided: 1

      postdeploy_script:
        riyic:
          name: "app/php/fcgi_apps/[0]/postdeploy_script"
          recipe: "app_php::fcgi_app"
        user_provided: 1

      migration_command:
        riyic:
          name: "app/php/fcgi_apps/[0]/migration_command"
          recipe: "app_php::fcgi_app"
        user_provided: 1


      # automatic definition in template
      domain:
        riyic:
          name: "app/php/fcgi_apps/[0]/domain"
          recipe: "app_php::fcgi_app"
        value: "default"

      target_path:
        riyic:
          name: "app/php/fcgi_apps/[0]/target_path"
          recipe: "app_php::fcgi_app"
        value: "/home/app"
        user_provided: 1

      db_host:
        value: "mysql"
        constante: 1


  db:
    
    role: mysql_db
    
    command: "/root/start.sh"
    
    expose:
    
      - 3306
    
    volumes:
      - /var/lib/mysql
    
    parameters:
    
      user:
        riyic:
          name: "dbs/mysql/dbs/[0]/user"
          recipe: "dbs_mysql::create_db"
        value: "dbuser"
        user_provided: 1
    
      name:
        riyic:
          name: "dbs/mysql/dbs/[0]/name"
          recipe: "dbs_mysql::create_db"
        value: "dbname"
        user_provided: 1
    
    
      password:
        riyic:
          name: "dbs/mysql/dbs/[0]/password"
          recipe: "dbs_mysql::create_db"
        value: 'passw0rd'
        user_provided: 1
    
      root_password:
        riyic:
          name: "dbs/mysql/server/root_password"
          recipe: "dbs_mysql::server"
        value: '09Dx329ksx&x23116d'
