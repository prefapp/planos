nombre: nodejs_internal_app
version: 0.1
description: Nodejs internal app

category: stack
tags:
  - nodejs

construcciones:
  role: app_nodejs
  command: "/root/start.sh"
  expose: 
    - 80
  environment: "@{app}#{env_vars}"

  parameters:
    # user defined
    #      data_dir:
    #        variable:
    #          display_name: "Directory where app stores data that must persists between deploys"
    #          validations:
    #            predefined: 'unix_path'
    #          field_type: text
    #        user_provided: 1
    
    env_vars:
      riyic:
        name: "app/nodejs/env_vars"
        recipe: "app_nodejs::app"
      user_provided: 1

    repo_url:
      riyic:
        name: "app/nodejs/repo_url"
        recipe: "app_nodejs::app"
      user_provided: 1

    repo_type:
      riyic:
        name: "app/nodejs/repo_type"
        recipe: "app_nodejs::app"
      value: "git"
      user_provided: 1

    revision:
      riyic:
        name: "app/nodejs/revision"
        recipe: "app_nodejs::app"
      value: "HEAD"
      user_provided: 1

    credential:
      riyic:
        name: "app/nodejs/credential"
        recipe: "app_nodejs::app"
      value: "" 
      user_provided: 1

    extra_packages:
      riyic:
        name: "app/nodejs/extra_packages"
        recipe: "app_nodejs::app"
      value: []
      user_provided: 1

    extra_modules:
      riyic:
        name: "app/nodejs/extra_modules"
        recipe: "app_nodejs::app"
      value: []
      user_provided: 1

    postdeploy_script:
      riyic:
        name: "app/nodejs/postdeploy_script"
        recipe: "app_nodejs::app"
      user_provided: 1

    migration_command:
      riyic:
        name: "app/nodejs/migration_command"
        recipe: "app_nodejs::app"
      user_provided: 1


    # automatic definition in template
    #domain:
    #  riyic:
    #    name: "app/nodejs/domain"
    #    recipe: "app_nodejs::app"
    #  value: "default"
    #  #user_provided: 1

    target_path:
      riyic:
        name: "app/nodejs/target_path"
        recipe: "app_nodejs::app"
      value: "/home/app"
      #user_provided: 1
      
    entry_point:
      riyic:
        name: "app/nodejs/entry_point"
        recipe: "app_nodejs::app"
        default_value: 'index.js'
      user_provided: 1

    use_ssl:
      user_provided: 1
      variable:
        display_name: "Enable https with an autogenerated letsencrypt certificate"
        field_type: "radio"
        validations:
          fixed_values:
            - "yes"
            - "no"
        default_value: "no"
  
